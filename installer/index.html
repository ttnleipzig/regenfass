<!DOCTYPE html>
<html lang="en"
	class="min-h-full bg-slate-100 text-gray-800 dark:bg-slate-900 dark:text-gray-100 shadow-[inset_0px_-4px_50px_#46464610] dark:shadow-[inset_0px_-4px_144px_#46466644]">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>regenfass - installer</title>
	<meta name="description" content="Regenfass web installer. Install the software directly from the website." />
	<meta name="author" content="TTN Leipzig" />
	<meta name="darkreader-lock" content="" />
	<link rel="icon" type="image/png" href="public/img/regenfass.png" />
	<link rel="stylesheet" href="public/css/style.css" />
	<script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>

	<!-- opengraph -->
	<meta property="og:title" content="regenfass - installer" />
	<meta property="og:description"
		content="Regenfass web installer. Install the software directly from the website." />
	<meta property="og:image" content="/public/img/regenfass-opengraph.png" />
	<meta property="og:url" content="https://regenfass.ttn-leipzig.de/" />
	<meta property="og:site_name" content="regenfass" />
	<meta property="og:type" content="website" />

	<!-- jsonld for a product page -->
	<script type="application/ld+json">
		{
			"@context": "https://schema.org/",
			"@type": "Product",
			"name": "regenfass",
			"sku": "regenfass",
			"description": "Regenfass web installer. Install the software directly from the website.",
			"image": "https://regenfass.ttn-leipzig.de/public/img/regenfass-opengraph.png",
			"url": "https://regenfass.eu",
			"brand": {
				"@type": "Organization",
				"name": "TTN Leipzig",
				"url": "https://ttn-leipzig.de",
				"logo": "https://www.thethingsnetwork.org/logo/Leipzig.svg",
				"sameAs": [
					"https://twitter.com/ttnleipzig",
					"https://github.com/ttnleipzig"
				]
			},
			"offers": {
				"@type": "Offer",
				"price": "0",
				"priceCurrency": "EUR",
				"availability": "https://schema.org/InStock",
				"url": "https://regenfass.eu",
				"seller": {
					"@type": "Organization",
					"name": "TTN Leipzig",
					"url": "https://ttn-leipzig.de",
					"logo": "https://www.thethingsnetwork.org/logo/Leipzig.svg",
					"sameAs": [
						"https://twitter.com/ttnleipzig",
						"https://github.com/ttnleipzig"
					],
					"contactPoint": {
						"@type": "ContactPoint",
						"contactType": "user support",
						"email": "info@regenfass.eu",
						"url": "https://docs.regenfass.eu"
					}
				}
			},
			"aggregateRating": {
				"@type": "AggregateRating",
				"ratingValue": "5",
				"reviewCount": "1"
			},
			"review": {
				"@type": "Review",
				"reviewRating": {
					"@type": "Rating",
					"ratingValue": "5",
					"bestRating": "5"
				},
				"author": {
					"@type": "Person",
					"name": "Andr√© Lademan",
					"url": "https://andrelademann.de",
					"sameAs": [
						"https://twitter.com/vergissberlin",
						"https://github.com/vergissberlin"
					]
				}
			}
		}
	</script>

	<style>

	</style>
</head>

<body class="text-slate-700 dark:text-slate-100">
	<div class="max-w-screen-lg px-3 py-6 mx-auto">
		<div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between">
			<a href="/demo/astro-boilerplate">
				<div
					class="flex items-center text-2xl font-bold text-transparent bg-gradient-to-br from-sky-700 to-cyan-100 bg-clip-text">
					Regenfass
				</div>
			</a>
			<nav>
				<ul class="flex font-medium text-gray-800 gap-x-3 dark:text-gray-400">
					<li>
						<a href="https://regenfass.ttn-leipzig.de/"
							class="py-2 pr-2 hover:text-slate-500 dark:hover:text-white hover:underline">Docs</a>
					</li>
					<li>
						<a href="https://github.com/ttnleipzig"
							class="p-2 hover:text-slate-500 dark:hover:text-white hover:underline">GitHub</a>
					</li>
					<li>
						<a href="https://twitter.com/ttn-leipzig"
							class="p-2 hover:text-slate-500 dark:hover:text-white hover:underline">Matrix</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>

	<div class="max-w-screen-lg px-3 py-6 mx-auto">
		<div class="flex flex-col items-center md:flex-row md:justify-between md:gap-x-24">
			<div>
				<h1 class="text-3xl font-bold">Hi there! üëã</h1>
				<p class="mt-6 text-xl leading-9">
					This project is about a smart water tank. It measures
					the water level and sends the data to a server. The
					server can be used to control the water pump. The pump
					can be controlled via a web interface or via a telegram
					bot. It uses a HC-SR04 ultrasonic sensor to measure the
					water level. The data is sent to
					<span class="text-transparent bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text">The Things
						Network</span>
					via a
					<span
						class="text-transparent bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text">LoRaWAN</span>
					gateway.
				</p>
			</div>
			<div class="hidden shrink-0 lg:block">
				<img src="public/img/regenfass.png" alt="Avatar image" loading="lazy" />
			</div>
		</div>
	</div>

	<div class="max-w-screen-lg px-3 py-6 mx-auto transition-all duration-300 ease-in-out">
		<span class="relative inline-flex">
			<h2 class="mb-6 text-2xl font-bold">Installation & configuration</h2>
			<span class="absolute top-0 right-0 flex w-3 h-3 -mt-1 -mr-4">
				<span class="absolute inline-flex w-full h-full rounded-full opacity-75 animate-ping bg-sky-400"></span>
				<span class="relative inline-flex w-3 h-3 rounded-full bg-sky-500"></span>
			</span>
		</span>

		<details id="steps-installation"
			class="rounded-t shadow-lg bg-sky-200 open:bg-sky-100 dark:bg-slate-800 dark:text-slate-200 border-grey-lighter dark:border-slate-500 dark:open:bg-slate-700 dark:hover:bg-slate-700 dark:shadow-[rgba(13,_38,_76,_0.19)_0px_9px_20px]">
			<summary
				class="flex items-center p-4 text-xl rounded-t open:hover:bg-sky-300 open:hover:border-b-0 hover:bg-sky-300 dark:hover:bg-slate-600"
				onclick="document.getElementById('steps-configuration').open = false;">
				1. Installation
				<button title="Installation" class="ml-auto">
					<svg class="w-4 h-4 -mr-1 opacity-75 fill-current" xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 20 20">
						<path
							d="M12.95 10.707l.707-.707L8 4.343 6.586 5.757 10.828 10l-4.242 4.243L8 15.657l4.95-4.95z" />
					</svg>
				</button>
			</summary>

			<div class="p-4 text-lg">
				<ol class="ml-4 text-gray-700 list-inside dark:text-gray-400">
					<li class="flex items-center gap-3"><span class="text-4xl text-sky-500">‚ù∂</span> <span>Connect your microcontroller with an USB cable to your computer.</span></li>
					<li class="flex items-center gap-3"><span class="text-4xl text-sky-500">‚ù∑</span> <span>Select the microcontroller type from the drop down.</span></li>
					<li class="flex items-center gap-3"><span class="text-4xl text-sky-500">‚ù∏</span> <span>Click the install button.</span></li>
				</ol>

				<p class="text-center">
					<select title="Select the micro controller type" name="type" id="type"
						class="p-6 mr-0 bg-white rounded-l-lg dark:bg-slate-600" style="margin-right: -4px">
						<option value="heltec" selected>
							Helltec LoRa32
						</option>
						<option value="esp32-generic">
							Generic ESP32
						</option>
					</select>
					<esp-web-install-button manifest="/manifest_heltec.json">
						<button slot="activate" type="button"
							class="px-12 py-5 my-5 ml-0 text-lg font-medium rounded-r-lg shrink-0 bg-gradient-to-br from-sky-500 to-cyan-400 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-600/50">
							Install
						</button>
						<span slot="unsupported">Ah snap, your browser doesn't work!</span>
						<span slot="not-allowed">
							Ah snap, you are not allowed to use this on HTTP!
						</span>
					</esp-web-install-button>
				</p>
			</div>
		</details>

		<details id="steps-configuration" open
			class="rounded-b shadow-lg bg-sky-200 open:bg-sky-100 dark:bg-slate-800 dark:text-slate-200 border-grey-lighter dark:border-slate-500 dark:open:bg-slate-700 dark:hover:bg-slate-700 dark:shadow-[rgba(13,_38,_76,_0.19)_0px_9px_20px]">
			<summary
				class="flex items-center p-4 text-xl rounded-b open:hover:rounded-b-none open:rounded-b-none open:hover:bg-sky-300 hover:bg-sky-300 dark:hover:bg-slate-600"
				onclick="document.getElementById('steps-installation').open = false;">
				2. Configuration
				<button title="Installation" class="ml-auto">
					<svg class="w-4 h-4 -mr-1 opacity-75 fill-current ripple" xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 20 20">
						<path
							d="M12.95 10.707l.707-.707L8 4.343 6.586 5.757 10.828 10l-4.242 4.243L8 15.657l4.95-4.95z" />
					</svg>
				</button>
			</summary>

			<div class="p-4 leading-normal text-md">
				<section class="mb-4 border-b-1 border-slate-400">
					<h4 class="my-2 font-semibold text-md">
						2.1. Connect to the serial device
					</h4>

					<div class="flex w-full gap-8">
						<div class="flex-5">
							<button id="connection-button"
								class="w-48 p-3 mb-4 font-semibold border rounded ripple bg-sky-300 hover:bg-sky-400 dark:bg-slate-800 dark:border-slate-600 hover:border-slate-300 dark:hover:bg-slate-900 dark:active:bg-slate-700">
								Connect
							</button>
						</div>

						<div class="grid flex-auto gap-2 text-sm grid-col-2">
							<div id="connection-indicator"
								class="flex px-4 py-2 space-x-3 rounded bg-slate-100 dark:bg-slate-200 dark:bg-slate-600">
								<span
									class="w-4 h-4 transition-colors duration-300 ease-in-out border rounded-full bg-slate-300 border-slate-400"></span>
								<p class="w-24 font-semibold text-slate-600 dark:text-slate-700">Connection</p>
								<p>‚Ä¶</p>
							</div>

							<div id="port-indicator"
								class="flex px-4 py-2 space-x-3 rounded bg-slate-100 dark:bg-slate-200 dark:bg-slate-600">
								<span
									class="w-4 h-4 transition-colors duration-300 ease-in-out border rounded-full bg-slate-300 border-slate-400"></span>
								<p class="w-24 font-semibold text-slate-600 dark:text-slate-700">Port</p>
								<p>‚Ä¶</p>
							</div>

							<div id="readable-indicator"
								class="flex px-4 py-2 space-x-3 rounded bg-slate-100 dark:bg-slate-200 dark:bg-slate-600">
								<span
									class="w-4 h-4 transition-colors duration-300 ease-in-out border rounded-full bg-slate-300 border-slate-400"></span>
								<p class="w-24 font-semibold text-slate-600 dark:text-slate-700">
									Readable
								</p>
								<p>‚Ä¶</p>
							</div>

							<div id="writeable-indicator"
								class="flex px-4 py-2 space-x-3 rounded bg-slate-100 dark:bg-slate-200 dark:bg-slate-600">
								<span
									class="w-4 h-4 transition-colors duration-300 ease-in-out border rounded-full bg-slate-300 border-slate-400"></span>
								<span class="w-24 font-semibold text-slate-600 dark:text-slate-700">Writeable</span>
								<span>‚Ä¶</span>
							</div>
							<div id="written-indicator"
								class="flex px-4 py-2 space-x-3 rounded bg-slate-200 dark:bg-slate-600">
								<span
									class="w-4 h-4 transition-colors duration-300 ease-in-out border rounded-full bg-slate-300 border-slate-400"></span>
								</span>
								<span class="w-24 font-semibold text-slate-600 dark:text-slate-700">Written</span>
								<span>‚Ä¶</span>
							</div>
						</div>
					</div>
				</section>

				<section>
					<h4 class="mt-6 mb-2 font-semibold text-md">
						2.2. Setup your LoRaWAN credentials
					</h4>

					<div class="flex gap-6 mb-4 rounded bg-slate-100 dark:bg-sky-400">
						<div class="px-8 py-4 bg-white rounded dark:bg-slate-800">
							<div class="mb-4">
								<label for="credentials-joineui"
									class="block mb-2 text-sm font-bold text-align-left">JoinEUI:</label>
								<input id="credentials-v" type="text" autocomplete="off" spellcheck="false"
									minlength="16" maxlength="16" placeholder="¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ "
									class="p-3 mb-1 border rounded text-slate-500 w-96 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-500" />
							</div>

							<div class="mb-4">
								<label for="credentials-deveui"
									class="block mb-2 text-sm font-bold text-align-left">DevEUI:</label>
								<input id="credentials-deveui" type="text" autocomplete="off" spellcheck="false"
									minlength="16" maxlength="16" placeholder="¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ "
									class="p-3 mb-1 border rounded text-slate-500 w-96 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-500" />
							</div>

							<div class="mb-4">
								<label for="credentials-appkey"
									class="block mb-2 text-sm font-bold text-align-left">AppKey:</label>
								<input id="credentials-appkey" type="text" autocomplete="off" spellcheck="false"
									minlength="32" maxlength="32"
									placeholder="¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ ¬∑¬∑ "
									class="p-3 mb-1 border rounded text-slate-500 w-96 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-500" />
							</div>
							<div class="text-right">
								<button type="button" id="send-button" disabled
									class="w-48 p-3 mb-4 font-semibold border rounded cursor-pointer ripple bg-sky-300 hover:bg-sky-400 dark:bg-slate-800 dark:border-slate-600 hover:border-slate-300 dark:hover:bg-slate-900 dark:active:bg-slate-700">
									Send
								</button>
							</div>
						</div>
						<div class="w-full px-8 py-4 text-sky-900">
							<div class="mb-4">
								<label for="send-log" class="block mb-2 font-bold text-align-left">Log:</label>
								<textarea id="send-log" rows="5" readonly placeholder="> "
									class="w-full p-3 font-mono text-sm border rounded text-slate-500 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-500"></textarea>
							</div>

							<label for="event-log" class="block mb-2 font-bold text-align-left">Event-Log:</label>
							<textarea id="event-log" rows="5" readonly placeholder="> "
								class="w-full p-3 font-mono text-sm border rounded text-slate-500 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-500"></textarea>
						</div>
					</div>
					<p class="mb-4 italic font-light text-center text-slate-500 dark:text-slate-400">
						<strong class="font-bold">Hint:</strong> If you don't know how to get your LoRaWAN credentials,
						please watch our <a href="https://www.youtube.com/watch?v=6q0996931M">video tutorial</a>
						on how to get them.
					</p>
				</section>
			</div>
		</details>
	</div>

	<div class="max-w-screen-lg px-3 py-6 mx-auto">
		<div class="flex flex-col items-center justify-between gap-6 sm:flex-row">
			<div class="sm:w-7/12">
				<div class="text-3xl font-bold">
					Subscribe to the
					<span class="text-transparent bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text">
						update newsletters
					</span>
				</div>
				<p class="mt-3 dark:text-gray-300">
					If you would like to be informed about software updates,
					you can subscribe to this newsletter.
				</p>
			</div>
			<div class="w-full sm:w-5/12">
				<form
					class="flex px-4 py-2 bg-white rounded-full dark:bg-slate-800 focus-within:ring-2 focus-within:ring-cyan-600 hover:ring-2 hover:ring-cyan-600">
					<input type="email" class="w-full appearance-none dark:bg-slate-800 focus:outline-none"
						placeholder="your@email-address.iot" />
					<button
						class="px-3 py-1 ml-2 text-sm font-semibold rounded-full text-sky-100 shrink-0 bg-gradient-to-br from-sky-500 to-cyan-400 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-300/50"
						type="submit">
						Subscribe
					</button>
				</form>
			</div>
		</div>
	</div>

	<div class="max-w-screen-lg px-3 py-6 mx-auto">
		<div
			class="pt-5 text-sm antialiased text-gray-400 border-t border-gray-300 dark:border-gray-600 dark:text-gray-300">
			<p>
				TTN Leipzig, Andr√© Lademan, Hardenbergstra√üe 48, 04275
				Leipzig, Germany, Europe, United Nations, Milky Way
			</p>
			<p>
				Powered by
				<a href="https://esphome.github.io/esp-web-tools/" target="_blank" rel="noopener noreferrer"
					class="hover:text-slate-500 dark:hover:text-white hover:underline">ESP Web Tools</a>
			</p>
		</div>
	</div>

	<script>
		/** @type {SerialPort|null} */
		let port = null

		const textEncoder = new TextEncoder()
		const textDecoder = new TextDecoder()
		/** @type {ReadableStream<Uint8Array>|null} */
		let reader = null
		/** @type {WritableStream<Uint8Array>|null} */
		let writer = null

		let isConnected = false,
			serialCommunicationBox = document.getElementById(
				"serial-communication-box"
			),
			connectionButton = document.getElementById("connection-button"),
			sendInput = document.getElementById("send-input"),
			sendButton = document.getElementById("send-button"),
			sendLog = document.getElementById("send-log"),
			eventLog = document.getElementById("event-log"),
			classSuccessBg = "bg-green-400",
			classSuccessText = "text-green-500",
			classInfoBg = "bg-sky-400",
			classInfoText = "text-sky-500",
			classErrorBg = "bg-red-400",
			classErrorText = "text-red-500,",
			classDefaultBg = "bg-slate-300",
			classDefaultText = "text-slate-500"

		// ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
		// Function to set status indicator an write log for given id
		// ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
		let setStatusIndicator = (id, status, log, reset = true) => {
			let indicator = document.getElementById(id)
			let ledElement = indicator.children[0]
			let logElement = indicator.children[2]

			if (reset) {
				ledElement.classList.remove(classSuccessBg)
				ledElement.classList.remove(classInfoBg)
				ledElement.classList.remove(classErrorBg)
				ledElement.classList.add(classDefaultBg)
			}

			switch (status) {
				case "success":
					ledElement.classList.remove(classDefaultBg)
					ledElement.classList.add(classSuccessBg)
					logElement.textContent = log || "Success"
					break
				case "info":
					ledElement.classList.remove(classDefaultBg)
					ledElement.classList.add(classInfoBg)
					logElement.textContent = log || "Warning"
					break
				case "warning":
					ledElement.classList.remove(classDefaultBg)
					ledElement.classList.add(classDefaultBg)
					logElement.textContent = log || "Warning"
					break
				case "error":
					ledElement.classList.remove(classDefaultBg)
					ledElement.classList.add(classErrorBg)
					logElement.textContent = log || "Error"
					break
				default:
					ledElement.classList.add(classDefaultBg)
					logElement.textContent = log || "Unknown"
					break
			}
		}

		/**
		 * Connect to serial device
		 *
		 * @throws {DOMException} - Error message
		 * @return void
		 **/
		async function serialConnect() {
			try {
				port = await navigator.serial.requestPort()
				await port.open({
					baudRate: 115200,
					parity: "none",
					stopBits: 1,
					flowControl: "none",
				})
				setStatusIndicator(
					"connection-indicator",
					"success",
					"Connected"
				)
				setStatusIndicator(
					"port-indicator",
					"success",
					"Port opened"
				)
				setStatusIndicator(
					"readable-indicator",
					"success",
					"Readable"
				)
				setStatusIndicator(
					"writeable-indicator",
					"success",
					"Writeable"
				)
				sendButton.disabled = false
				connectionButton.textContent = "Disconnect"
				isConnected = true

				// ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
				// Event listener for serial connection (not working)
				// ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
				// port.addEventListener("connect", (e) => {
				//     eventLog.textContent +=
				//         "Connected to " +
				//         e.target.getInfo().usbProductId +
				//         "\n"
				// })

				// port.serial.addEventListener("disconnect", (e) => {
				//     eventLog.textContent +=
				//         "Disconnected from " +
				//         e.target.getInfo().usbProductId +
				//         "\n"
				// })

				reader = port.readable.getReader()
				writer = port.writable.getWriter()
			} catch (e) {
				setStatusIndicator(
					"connection-indicator",
					"error",
					e.message
				)
				console.error(e)
			}
		}

		/**
		 * Disconnect from serial device
		 **/
		async function serialDisconnect() {
			if (port) {
				try {
					// kill read and write stream
					if (reader) {
						await reader.cancel()
						await reader.releaseLock()
					}
					if (writer) {
						await writer.abort()
						await writer.releaseLock()
					}

					await port.close()
					port = null

					setStatusIndicator(
						"connection-indicator",
						"info",
						"Disconnected"
					)
					setStatusIndicator(
						"port-indicator",
						null,
						"Port closed"
					)
					setStatusIndicator(
						"readable-indicator",
						null,
						"Not readable"
					)
					setStatusIndicator(
						"writeable-indicator",
						null,
						"Not writeable"
					)
					setStatusIndicator("written-indicator", null, "‚Ä¶")
					sendButton.disabled = true
					connectionButton.textContent = "Connect"
					isConnected = false
				} catch (e) {
					setStatusIndicator(
						"connection-indicator",
						"error",
						e.message
					)
					setStatusIndicator("port-indicator", null, "‚Ä¶")
					setStatusIndicator("readable-indicator", null, "‚Ä¶")
					setStatusIndicator("writeable-indicator", null, "‚Ä¶")
					setStatusIndicator("written-indicator", null, "‚Ä¶")
					console.error(e)
				}
			}
		}

		/**
		 * Read data from serial device
		 *
		 * @throws {DOMException} - Error message
		 * @return void
		 **/
		async function serialRead() {
			try {
				while (true) {
					const {value, done} = await reader.read()
					const decoded = textDecoder.decode(value)

					sendLog.textContent += decoded

					if (done) break
				}
			} catch (err) {
				const errorMessage = `error reading data: ${err}`
				console.error(errorMessage)
				sendLog.textContent += errorMessage + "\n"
				setStatusIndicator("written-indicator", "error")
			}
		}

		/**
		 * Write data to serial device
		 *
		 * @param {string} data - Data to write to the serial device
		 * @throws {DOMException} - Error message
		 * @return void
		 **/
		async function serialWrite(data) {
			try {
				await writer.write(textEncoder.encode(data + "\n"))
				console.log("Write: " + data)
				sendLog.textContent += `Write: ${data} \n`
				setStatusIndicator("written-indicator", "success")
			} catch (err) {
				const errorMessage = `Error writing data: ${err}`
				console.error(errorMessage)
				sendLog.textContent += errorMessage + "\n"
				setStatusIndicator(
					"written-indicator",
					"error",
					"Error writing data: " + err
				)
			}
		}

		// ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
		// Connect to serial device and save status to the indicator
		// ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
		connectionButton.addEventListener("click", async () => {
			if ("serial" in navigator) {
				isConnected ? serialDisconnect() : serialConnect()
			} else {
				setStatusIndicator(
					"connection-indicator",
					"error",
					"Your browser does not support the Web Serial API."
				)
			}
		})

		// ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
		// Send data to the serial device
		// ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
		sendButton.addEventListener("click", async () => {
			await serialWrite(sendInput.value)
			await serialRead()
		})

		navigator.serial.getPorts().then((ports) => {
			if (ports.length > 0) {
				eventLog.textContent +=
					"Connected to " +
					ports[0].getInfo().usbProductId +
					"\n"
			} else {
				eventLog.textContent += "No device connected\n"
			}
		});
	</script>

	<script>
		const button = document.querySelector("esp-web-install-button")
		document
			.getElementById("type")
			.addEventListener("change", (event) => {
				button.setAttribute(
					"manifest",
					`./manifest_${event.target.value}.json`
				)
			});
		/*
		button.addEventListener("initializing", (event) => {
			console.log("initializing state", event);
		});
		button.addEventListener("preparing", (event) => {
			console.log("preparing state", event);
		});
		button.addEventListener("erasing", (event) => {
			console.log("erasing state", event);
		});
		button.addEventListener("writing", (event) => {
			console.log("writing state", event);
		});
		button.addEventListener("finished", (event) => {
			console.log("finished state", event);
		});
		button.addEventListener("error", (event) => {
			console.log("error state", event);
		});
		button.addEventListener("install", (event) => {
			console.log("Installation started", event);
		});
		button.addEventListener("error", (event) => {
			console.error("Installation failed", event);
		});
		button.addEventListener("success", (event) => {
			console.log("Installation succeeded", event);
		});
		button.addEventListener("update", (event) => {
			console.log("Update available", event);
		});
		lashStateType {
		INITIALIZING = "initializing",
		PREPARING = "preparing",
		ERASING = "erasing",
		WRITING = "writing",
		FINISHED = "finished",
		ERROR = "error",
		}
		*/
	</script>
</body>

</html>
